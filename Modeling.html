<div class="splash" id="modelingsplash">

	<div class="row splashyla">
        <div class="col-md-12">
            <a href="http://2014.igem.org/"><img src="http://2014.igem.org/wiki/images/0/09/Aalto_Helsinki_Logov_iGEM.png" class="img-responsive igem-logo"></a>
        </div>
    </div>

	<div class= "row splashesittely">
		<div class="col-md-3">
		</div>
		<div class="col-md-6">
			<h1>Modeling</h1>
			<p class="bigsplashtext">
				To test our theory and how well our test results fit, we did some modeling, too. $\int_0^\infty{xdx}$
			</p>
		</div>
		<div class="col-md-3">
		</div>
	</div>

	<div class= "row splashala">
        <div class ="col-md-12 transp scroller">
            <a href="#Math">
                Scroll down to read more
                <img src="http://2014.igem.org/wiki/images/3/3e/Aalto_Helsinki_Nuoli.png" class="img-responsive center-block transp nuoli">
            </a>
        </div>
    </div>

	<div class="splashalavalikko">
		<a href="#Intro">Introduction</a><br>
		<a href="#Math">Mathematical Model</a><br>
        <a href="#Simulation">Simulation</a><br>
        <a href="#Accuracy">Accuracy</a><br>
    </div>

	<div class = "splashcopyright">
        <p class="transp">
            <a href="http://i-see-faces.deviantart.com/">Photo © Tanja Maria</a>
        </p>
    </div>
</div>

<!-- MathJax (LaTeX for the web) -->
<!-- "The Mathematical Association of America (MAA) continues to support MathJax as a MathJax Supporter.

The MAA is the largest professional society focused on mathematics accessible at the collegiate level. As an early adopter of the web, the MAA has led the way communicating mathematics online including resources such as MathDL, born-digital ebooks and journals. The MAA’s open-source homework system WeBWorK is used at over 500 institutions worldwide."

Dear Lassi (programmer-in-charge, Aalto-Helsinki iGEM 2014),

Based on the previous quote by the MathJax community, I hereby declare that, even if the scripts for displaying our math are located on another server, it doesn't matter. Should the support for MathJax ever cease to exist, the first victim would be the world wide mathematical community, not us.

This is a safe method. We are using LaTeX. Period!

Yours,
Otto Lamminpää
-->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script src="http://2014.igem.org/Team:Aalto-Helsinki/jquery-1.11.0.min.js?action=raw&ctype=text/js"></script>
<script src="http://2014.igem.org/Team:Aalto-Helsinki/bootstrap.min.js?action=raw&ctype=text/js"></script>
<script src="http://2014.igem.org/Team:Aalto-Helsinki/waypoints.min.js?action=raw&ctype=text/js"></script>
<div class="navbar navbar-default extrabar" data-spy="affix">
    <nav>
    	<a id="Intro-submenu" class="active" href="#Intro">Introduction</a>
        <a id="Math-submenu" href="#Math">Mathematical Model</a>
        <a id="Simulation-submenu" href="#Simulation">Simulation</a>
        <a id="Accuracy-submenu" href="#Accuracy">Accuracy</a>
    </nav>
</div>

<div class="update Intro"></div>
<article>
	<div class="link" id="Intro"></div>

	<h2>Introduction</h2>

	<p>
		To get an idea of how our gene circuit would work on an ideal situation, we explored the structure and dynamics of our system by creating a mathematical model of the reaction kinetics and a real-time simulation. Wit the mathematical model, we started with no information ready whatsoever and derived differential equations to demonstrate how the use of blue light and the changes in phosphorylated YF1 and FixJ concentrations would control the production of our three target proteins. We labeled them simply A, B, and C, because the system is intended to be used with any user defined three genes coding different proteins.
	</p>

	<p>
		Using our equations we constructed a simulation showing the effects of red and blue light on our system in real time. The user can control the input of both lights to see how they affect the production of proteins A, B and C. We experimented with different values for all constants and with trial-and-error iteration we arrived to a visualized simulation that can be used to demonstrate the intended funcion of our system. All in all, this is an idealization. Based on present and future measurement data, the parameters can be adjusted to better match the real world.
	</p>

</article>
<div class="update Intro"></div>
<div class="update Math"></div>
<article>
<div class="link" id="Math"></div>

	<h2>Mathematical model</h2>

	<h3>Overview </h3>

	<p>
		Here, we will discuss the dynamics and interactions of different proteins and promoters introduced in the research section. We have developed a simplified mathematical model describing our system.
	</p>

	<h3>Simplifications</h3>

	<p>
		We assumed that the species identified from our gene circuit are the only ones that affect the overall concentrations in our bacterial culture. The bonding of CI to OR sites is assumed to be insignificant compared to the overall concentration. The model is also strictly deterministic and doesn’t take into account any noise. The phosphorylation, decay, bonding and production of proteins are assumed to be linear functions of concentration. We further assumed that the phsophorylation of FixJ by phosphorylated YF1 would not involve phosphor
	</p>

	<p>
		The first model that was constructed before our lab work had even begun involves many harsh simplifications. Our aim was to get a general picture of how the system could work in ideal conditions and how stable it was.
	</p>

	<h3>Equations for dynamics</h3>

	<p>
		Based on the assumptions made before, we arrived at following differential equations to describe the idealized dynamics of our system:
	</p>
<!--
	<div class="row">
		<div class="img-center">
			<img src="http://2014.igem.org/wiki/images/0/0a/Aalto_Helsinki_Equations.png" class="img-responsive"></img>
			<p class="kuvateksti">
				Differential equations describing our system
			</p>
		</div>
	</div>
-->

	<p>
		\begin{eqnarray*}
		& & \frac{d[YF1]}{dt} = P_1Rbs_1 + DP_1[YF1]_{phos} - (Deg_{YF1}+I_B)[YF1] \\ \quad \\
		& & \frac{d[YF1]_{phos}}{dt} = I_B[YF1] - (Deg_{\text{YF1}} + DP_1)[YF1]_{phos} \\
		\
		& & \frac{d[FixJ]}{dt} = P_1Rbs_1 + DP_2[FixJ]_{phos} - (C_{phos}[YF1]_{phos} + Deg_{FixJ})[FixJ] \\
		\\
		& & \frac{d[FixJ]_{phos}}{dt} = C_{phos}[YF1]_{phos}[FixJ] - (DP_2[FixJ]_{phos} + Deg_{FixJ}[FixJ]) \\
		\\
		& & \frac{d[CI]}{dt} = P_2Rbs_1 - Deg_{CI}[CI] \\
		\\
		& & \frac{d[TetR]}{dt} = (P_A + P_B)Rbs_2 - Deg_{TetR}[TetR]
		\end{eqnarray*}
	</p>

	<h3>Legend</h3>
    <ul>
		<li><strong>$[YF1]$</strong> = concentration of $YF1$ protein</li>
		<li><strong>$[YF1]_{phos}$</strong> = concentration of phosphorylated $YF1$ protein</li>
		<li><strong>$[FixJ]$</strong> = concentration of $FixJ$ protein</li>
		<li><strong>$[FixJ]_{phos}$</strong> = concentration of phosphorylated $FixJ$ protein</li>
		<li><strong>$[CI]$</strong> = concentration of $CI$ protein</li>
		<li><strong>$[TetR]$</strong> = concentration of $TetR$ protein</li>
		<li><strong>$P_1$</strong> = relative strength of the first promoter in gene circuit</li>
		<li><strong>$P_2$</strong> = relative strength of the $FixK_2$ promoter</li>
		<li><strong>$P_A$</strong> = relative strength of the $P_R$ promoter, codes gene A</li>
		<li><strong>$P_B$</strong> = relative strength of the $P_{RM}$ promoter, codes gene B</li>
		<li><strong>$Rbs$</strong> = relative strengths of ribosome binding sites</li>
		<li><strong>$Deg$</strong> = degradation coefficient</li>
		<li><strong>$C_{phos}$</strong> = phosphorylation coefficient</li>
		<li><strong>$DP$</strong> = de-phosphorylation coefficient</li>
    </ul>

	<p>
		These equations describe the essential proteins our system ($YF1$, $FixJ$, Phosphorylated $YF1$, Phosphorylated $FixJ$, $CI$, $TetR$). Proteins are produced with rates that depend on the strength of respective promoter and ribosome binding site, and also when phosphorylated protein (denoted with phos) is dephosphorylated back to its original form. The concentration of all proteins reduces by degradation, the rate of which depends on the concentration of protein in question.
	</p>

	<h3>Dynamics' coefficients</h3>
	<p>
		$P_1$, $P_2$, $P_A$ and $P_B$ denote the relative strengths of promoters and $Rbs_1$&$Rbs2_$ the relative strengths of ribosome binding sites, which both affect the protein synthesis linearly. Each protein has its own degradation coefficient (denoted $Deg$). $I_B$ is the combined effect of blue light that affects the phosphorylation of $YF1$. The phosphorylation of $FixJ$ is assumed to depend on phosphorylation coefficient $C_{phos}$ and the concentration of phosphorylated $YF1$. The dephosphorylation here depends on a respective dephosphorylation coefficient $DP$(1&2 for $YF1$ and $FixJ$).
	</p>

	<h3>Equations for promoter activities</h3>
<!--
	<div class="row">
		<div class="img-center">
			<img src="http://2014.igem.org/wiki/images/a/a0/Aalto_Helsinki_Promoters.png" class="img-responsive"></img>
			<p class="kuvateksti">
				Equations for promoter activities
			</p>
		</div>
	</div>
-->
	<p>
		\begin{eqnarray*}
		& & P_2  = C_{P_2}N[CI] \\
		\\
		& & P_A =
		\begin{cases}
		C_{P_A}N[CI] \quad \text{if} \quad N[CI] \leq 1 \\
		0 \quad \text{if} \quad N[CI] > 1
		\end{cases} \\
		\\
		& & P_B =
		\begin{cases}
		C_{P_B}N[CI] \quad \text{if} \quad N[CI] < 1 \\
		C_{P_B}(1-(N[CI] - 1)) \quad \text{if} \quad 1 \leq N[CI] < 2 \\
		0 \quad \text{if} \quad N[CI] \geq 2
		\end{cases} \\
		\\
		& & P_C =
		\begin{cases}
		C_{P_A}(1-N_2[TetR]) \quad \text{if} \quad N_2[TetR] \leq 1 \\
		0 \quad \text{if} \quad N_2[TetR] > 1
		\end{cases}
		\end{eqnarray*}
	</p>
	<h3>Promoters' coefficients</h3>

	<p>
		Here, the $C_{P_n}$'s denote the respective promoter's maximum activity. The $N$ in front of $CI$ and $TetR$ concentrations is a normalization coefficient,
		which is needed to map the fitting part of concentrations' values to the interval $(0,1)$. This way, when multiplied by the promoters' maximum activity values, we get values in the interval $(0, C_{P_n})$  The fuctions definitions must also change so that they never take negative values, which would make no sense when talking about promoter activities.
	</p>

</article>
<div class="update Math"></div>
<div class="update Simulation"></div>
<article>
	<div class="link" id="Simulation"></div>

	<h2>Simulation</h2>

	<h3>Overview </h3>

	<p>
		Based on our mathematical model, we created an interactive simulation and a graphical user interface for it. This visualization, although idealized, is ideal for demonstrating the intended functioning of our gene circuit and gene switch system. We included two swithces, one for red and one for blue light. With these, the user can see the effect of light intensity to a bacterial coulture in real time. Here, proteins A, B and C are represented by GFP, RFP and BFP, so the bacteria change color in different circumstances. The original simulation was written in Python and later translated into Javascript, and it can be viewed on our web page by anyone. The source code can be found on our GitHub page.
	<p/>

	<h3>Lights </h3>

	<p>
		In our system, the communication between user and the bacteria happens via illumination of blue light to the coulture. Blue light phosphorylates the $YF1$-protein, which is the key to controlling the overall protein production inside the bacterium. In the simulation, this is represented by change in the $I_B$ parameter from the mathematical model. This takes values between 0 and 1, and the rest of system behaves as described earlier.
	</p>
	<p>
		Our original design had also an intensity switch, operated by red light. Due to time constraits, this wasn't yet implemented in our gene circuit. In the simulation, we added a second user controlled parameter in front of every promoter. This takes values between 0 and 1, representing the no production at all -state and the production at maximum promoter activity. With this, the user has control of all protein concentrations. The assumed mechanism is idealized and has a linear effect on the activity.
	</p>

	<h3>Runge-Kutta method </h3>

	<p>
		The dynamics of our system were approximated using 4th order Runge-Kutta (RK4) method for the differential equations in our mathematical model. The point of this method is to approximate the function in question by it's derivatives without having to solve the function itself. The starting values of each concentrations are assumed to be zero, so y(0) = 0. With this, the simulation computes the next datapoint adding the derivative times a timestep (h) to previous concentrations. The method uses a mean value of different derivatives (the different k's below) during this timestep h to get a more accurate approximation.
	</p>
<!--
	<div class="row row-eq-height">
      <div class="col-md-6 feat-left">
        <img src="http://2014.igem.org/wiki/images/6/63/Aalto_Helsinki_IGEM_rungekutta.png" class="img-responsive"></img>
        <p class="kuvateksti">
			RK4 equations
		</p>
      </div>
      <div class="col-md-6 feat-right">
        <img src="http://2014.igem.org/wiki/images/6/63/Aalto_Helsinki_IGEM_rungekutta.png" class="img-responsive"></img>
        <p class="kuvateksti">
			RK4 equations
		</p>
      </div>
    </div>
-->

	<p>
		\begin{eqnarray*}
		& & y' = f(t,y(t)), \quad y(t_0) = y_0 \\
		\\
		\\
		& & y_{n+1} = y_n + \frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4) \\
		& & t_{n+1} = t_n + h
		\\
		\\
		& & k_1 = f(t_n,y_n) \\
		& & k_2 = f(t_n +\frac{h}{2}, y_n + \frac{h}{2}k_1) \\
		& & k_3 = f(t_n + \frac{h}{2}, y_n + \frac{h}{2}k_2) \\
		& & k_4 = f(t_n + \frac{h}{2}, y_n +hk_3)
		\end{eqnarray*}
	</p>

	<h3>Software implementation</h3>

	<p>
		A computational model was created based on our mathematical model and the RK4 approximation. We made a real-time plotting function to illustrate the dynamics with each timestep. We added two light switches so that the user can have an impact on our simulation in real time. This all was then further developed into a presentable, user-friendly form that is accessible from our website. The simulation itself was created using Python and translated into Javascript for web implementation.
	</p>

	<div class="row">
		<div class="img-center">
			<img src="http://2014.igem.org/wiki/images/0/03/Aalto_Helsinki_Simulation.png" class="img-responsive">
			<p class="kuvateksti">
				The UI of our simulation
			</p>
		</div>
	</div>


	<p>
		To demonstrate our work to the general public in an event called Summer of Startups Demo Day, we made a <a href="http://aaltohelsinki.com/simulation">simulation</a> that shows our system in action. It shows an animated bacteria plate with adjustable light intensity sliders to remotely control the bacteria. The proteins the bacteria produce are colors, so you can see how the changes in light intensity correlate to the color of the colonies on the plate. The simulation also has a nice grap that shows the protein levels in one second intervals so you can see more clearly what's going on in the cell.
	</p>

	<p>
		All of the code (including a more in-detail Python graph simulation) is available at the project's <a href="http://github.com/iGEM-QSF/SimCircus">GitHub page.</a>
	</p>
</article>

<div class="update Simulation"></div>
<div class="update Accuracy"></div>

<article>
	<div class="link" id="Accuracy"></div>

	<h2>Accuracy </h2>

	<p>
		No noise was implemented in our simulation, so the results are over-idealized. This is generally very far from the truth in all biological systems, but having no noise gave us a pretty good idea of how things should work in a best case scenario.

	</p>

	<p>
		 So far we have also used arbitrary parameters, simplified reaction pathways and reaction equations. In it's current state the simulation gives a good idea on how the system should work. Making it realistic and really accurate requires a lot of measurement of appropriate parameters and tuning. Still, this version is ideal for demonstration of our idea.
	</p>

</article>
<div class="update Simulation"></div>
